{"version":3,"sources":["public/src/client/topic/threadTools.js"],"names":["define","components","translator","ThreadTools","init","tid","renderMenu","topicContainer","$","on","topicCommand","socket","emit","tids","cid","ajaxify","data","err","app","alertError","alertSuccess","btn","this","message","parents","find","trigger","require","move","deletePosts","fork","movePosts","changeWatching","type","alert","alert_id","title","timeout","setFollowState","window","$this","dropdownMenu","html","parseAndTranslate","element","command","translate","msg","bootbox","confirm","setLockedState","threadEl","get","parseInt","attr","isLocked","privileges","isAdminOrMod","toggleClass","parent","hideReply","deleted","user","uid","locked","setDeleteState","isDelete","deleter","deletedTimestampISO","utils","toISOString","Date","now","replaceWith","timeago","setPinnedState","isPinned","pinned","state","menu"],"mappings":"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","file":"public/src/client/topic/threadTools.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/threadTools', [\r\n\t'components',\r\n\t'translator',\r\n], function (components, translator) {\r\n\tvar ThreadTools = {};\r\n\r\n\tThreadTools.init = function (tid) {\r\n\t\trenderMenu();\r\n\r\n\t\tvar topicContainer = $('.topic');\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/delete\"]', function () {\r\n\t\t\ttopicCommand('delete', tid);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/restore\"]', function () {\r\n\t\t\ttopicCommand('restore', tid);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/purge\"]', function () {\r\n\t\t\ttopicCommand('purge', tid);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/lock\"]', function () {\r\n\t\t\tsocket.emit('topics.lock', { tids: [tid], cid: ajaxify.data.cid });\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/unlock\"]', function () {\r\n\t\t\tsocket.emit('topics.unlock', { tids: [tid], cid: ajaxify.data.cid });\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/pin\"]', function () {\r\n\t\t\tsocket.emit('topics.pin', { tids: [tid], cid: ajaxify.data.cid });\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/unpin\"]', function () {\r\n\t\t\tsocket.emit('topics.unpin', { tids: [tid], cid: ajaxify.data.cid });\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/mark-unread\"]', function () {\r\n\t\t\tsocket.emit('topics.markUnread', tid, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[topic:mark_unread.success]]');\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/mark-unread-for-all\"]', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tsocket.emit('topics.markAsUnreadForAll', [tid], function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[topic:markAsUnreadForAll.success]]');\r\n\t\t\t\tbtn.parents('.thread-tools.open').find('.dropdown-toggle').trigger('click');\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/move\"]', function () {\r\n\t\t\trequire(['forum/topic/move'], function (move) {\r\n\t\t\t\tmove.init([tid], ajaxify.data.cid);\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/delete/posts\"]', function () {\r\n\t\t\trequire(['forum/topic/delete-posts'], function (deletePosts) {\r\n\t\t\t\tdeletePosts.init();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/fork\"]', function () {\r\n\t\t\trequire(['forum/topic/fork'], function (fork) {\r\n\t\t\t\tfork.init();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/move-posts\"]', function () {\r\n\t\t\trequire(['forum/topic/move-post'], function (movePosts) {\r\n\t\t\t\tmovePosts.init();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\ttopicContainer.on('click', '[component=\"topic/following\"]', function () {\r\n\t\t\tchangeWatching('follow');\r\n\t\t});\r\n\t\ttopicContainer.on('click', '[component=\"topic/not-following\"]', function () {\r\n\t\t\tchangeWatching('unfollow');\r\n\t\t});\r\n\t\ttopicContainer.on('click', '[component=\"topic/ignoring\"]', function () {\r\n\t\t\tchangeWatching('ignore');\r\n\t\t});\r\n\r\n\t\tfunction changeWatching(type) {\r\n\t\t\tsocket.emit('topics.changeWatching', { tid: tid, type: type }, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alert({\r\n\t\t\t\t\t\ttype: 'danger',\r\n\t\t\t\t\t\talert_id: 'topic_follow',\r\n\t\t\t\t\t\ttitle: '[[global:please_log_in]]',\r\n\t\t\t\t\t\tmessage: '[[topic:login_to_subscribe]]',\r\n\t\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tvar message = '';\r\n\t\t\t\tif (type === 'follow') {\r\n\t\t\t\t\tmessage = '[[topic:following_topic.message]]';\r\n\t\t\t\t} else if (type === 'unfollow') {\r\n\t\t\t\t\tmessage = '[[topic:not_following_topic.message]]';\r\n\t\t\t\t} else if (type === 'ignore') {\r\n\t\t\t\t\tmessage = '[[topic:ignoring_topic.message]]';\r\n\t\t\t\t}\r\n\t\t\t\tsetFollowState(type);\r\n\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\talert_id: 'follow_thread',\r\n\t\t\t\t\tmessage: message,\r\n\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(window).trigger('action:topics.changeWatching', { tid: tid, type: type });\r\n\t\t\t});\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction renderMenu() {\r\n\t\t$('.topic').on('show.bs.dropdown', '.thread-tools', function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar dropdownMenu = $this.find('.dropdown-menu');\r\n\t\t\tif (dropdownMenu.html()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('topics.loadTopicTools', { tid: ajaxify.data.tid, cid: ajaxify.data.cid }, function (err, data) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tapp.parseAndTranslate('partials/topic/topic-menu-list', data, function (html) {\r\n\t\t\t\t\tdropdownMenu.html(html);\r\n\t\t\t\t\t$(window).trigger('action:topic.tools.load', {\r\n\t\t\t\t\t\telement: dropdownMenu,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction topicCommand(command, tid) {\r\n\t\ttranslator.translate('[[topic:thread_tools.' + command + '_confirm]]', function (msg) {\r\n\t\t\tbootbox.confirm(msg, function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('topics.' + command, { tids: [tid], cid: ajaxify.data.cid }, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tThreadTools.setLockedState = function (data) {\r\n\t\tvar threadEl = components.get('topic');\r\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar isLocked = data.isLocked && !ajaxify.data.privileges.isAdminOrMod;\r\n\r\n\t\tcomponents.get('topic/lock').toggleClass('hidden', data.isLocked).parent().attr('hidden', data.isLocked ? '' : null);\r\n\t\tcomponents.get('topic/unlock').toggleClass('hidden', !data.isLocked).parent().attr('hidden', !data.isLocked ? '' : null);\r\n\r\n\t\tvar hideReply = (data.isLocked || ajaxify.data.deleted) && !ajaxify.data.privileges.isAdminOrMod;\r\n\r\n\t\tcomponents.get('topic/reply/container').toggleClass('hidden', hideReply);\r\n\t\tcomponents.get('topic/reply/locked').toggleClass('hidden', ajaxify.data.privileges.isAdminOrMod || !data.isLocked || ajaxify.data.deleted);\r\n\r\n\t\tthreadEl.find('[component=\"post\"]:not(.deleted) [component=\"post/reply\"], [component=\"post\"]:not(.deleted) [component=\"post/quote\"]').toggleClass('hidden', hideReply);\r\n\t\tthreadEl.find('[component=\"post/edit\"], [component=\"post/delete\"]').toggleClass('hidden', isLocked);\r\n\r\n\t\tthreadEl.find('[component=\"post\"][data-uid=\"' + app.user.uid + '\"].deleted [component=\"post/tools\"]').toggleClass('hidden', isLocked);\r\n\r\n\t\t$('[component=\"post/header\"] i.fa-lock').toggleClass('hidden', !data.isLocked);\r\n\t\t$('[component=\"post/tools\"] .dropdown-menu').html('');\r\n\t\tajaxify.data.locked = data.isLocked;\r\n\t};\r\n\r\n\tThreadTools.setDeleteState = function (data) {\r\n\t\tvar threadEl = components.get('topic');\r\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcomponents.get('topic/delete').toggleClass('hidden', data.isDelete).parent().attr('hidden', data.isDelete ? '' : null);\r\n\t\tcomponents.get('topic/restore').toggleClass('hidden', !data.isDelete).parent().attr('hidden', !data.isDelete ? '' : null);\r\n\t\tcomponents.get('topic/purge').toggleClass('hidden', !data.isDelete).parent().attr('hidden', !data.isDelete ? '' : null);\r\n\t\tcomponents.get('topic/deleted/message').toggleClass('hidden', !data.isDelete);\r\n\r\n\t\tif (data.isDelete) {\r\n\t\t\tapp.parseAndTranslate('partials/topic/deleted-message', {\r\n\t\t\t\tdeleter: data.user,\r\n\t\t\t\tdeleted: true,\r\n\t\t\t\tdeletedTimestampISO: utils.toISOString(Date.now()),\r\n\t\t\t}, function (html) {\r\n\t\t\t\tcomponents.get('topic/deleted/message').replaceWith(html);\r\n\t\t\t\thtml.find('.timeago').timeago();\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar hideReply = data.isDelete && !ajaxify.data.privileges.isAdminOrMod;\r\n\r\n\t\tcomponents.get('topic/reply/container').toggleClass('hidden', hideReply);\r\n\t\tcomponents.get('topic/reply/locked').toggleClass('hidden', ajaxify.data.privileges.isAdminOrMod || !ajaxify.data.locked || data.isDelete);\r\n\t\tthreadEl.find('[component=\"post\"]:not(.deleted) [component=\"post/reply\"], [component=\"post\"]:not(.deleted) [component=\"post/quote\"]').toggleClass('hidden', hideReply);\r\n\r\n\t\tthreadEl.toggleClass('deleted', data.isDelete);\r\n\t\tajaxify.data.deleted = data.isDelete;\r\n\t};\r\n\r\n\r\n\tThreadTools.setPinnedState = function (data) {\r\n\t\tvar threadEl = components.get('topic');\r\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcomponents.get('topic/pin').toggleClass('hidden', data.isPinned).parent().attr('hidden', data.isPinned ? '' : null);\r\n\t\tcomponents.get('topic/unpin').toggleClass('hidden', !data.isPinned).parent().attr('hidden', !data.isPinned ? '' : null);\r\n\t\t$('[component=\"post/header\"] i.fa-thumb-tack').toggleClass('hidden', !data.isPinned);\r\n\t\tajaxify.data.pinned = data.isPinned;\r\n\t};\r\n\r\n\tfunction setFollowState(state) {\r\n\t\tvar menu = components.get('topic/following/menu');\r\n\t\tmenu.toggleClass('hidden', state !== 'follow');\r\n\t\tcomponents.get('topic/following/check').toggleClass('fa-check', state === 'follow');\r\n\r\n\t\tmenu = components.get('topic/not-following/menu');\r\n\t\tmenu.toggleClass('hidden', state !== 'unfollow');\r\n\t\tcomponents.get('topic/not-following/check').toggleClass('fa-check', state === 'unfollow');\r\n\r\n\t\tmenu = components.get('topic/ignoring/menu');\r\n\t\tmenu.toggleClass('hidden', state !== 'ignore');\r\n\t\tcomponents.get('topic/ignoring/check').toggleClass('fa-check', state === 'ignore');\r\n\t}\r\n\r\n\r\n\treturn ThreadTools;\r\n});\r\n"]}