{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer.js"],"names":["define","taskbar","translator","controls","uploads","formatting","drafts","tags","categoryList","preview","resize","autocomplete","scrollStop","composer","active","undefined","posts","bsEnvironment","$","window","off","onWindowResize","on","ev","data","localStorage","removeItem","cid","env","utils","findBootstrapEnvironment","modified","discard","discardConfirm","length","modal","translate","translated","bootbox","confirm","removeComposerHistory","ajaxify","template","compose","history","back","isMobile","toggle","reposition","location","pathname","startsWith","config","relative_path","mobileHistoryAppend","alreadyOpen","post","type","id","hasOwnProperty","uuid","push","generateUUID","existingUUID","updateActive","load","actionText","action","translatedAction","title","replace","save_id","app","user","uid","join","tid","pid","updateVisibility","composerAlert","post_uuid","message","find","removeAttr","alert","timeout","alert_id","findByTid","parseInt","addButton","iconClass","onClick","newTopic","pushData","body","isMain","trigger","addQuote","toPid","selectedPid","username","text","escapedTitle","link","newReply","postContainer","bodyEl","prevText","val","defaultLang","onTranslated","focusElements","render","editPost","socket","emit","err","threadData","alertError","activate","onShow","createNewComposer","options","enhance","postData","attr","titleEl","handleEl","draft","get","submitBtn","init","addHandler","addComposerButtons","handleToggler","removeClass","privileges","initialize","allowTopicsThumbnail","toggleThumbEls","thumb","e","preventDefault","stopPropagation","this","keypress","event","keyCode","which","ctrlKey","btn","prop","minimize","matchScroll","handle","handleHelp","handleSearch","screenfull","enabled","addClass","isTopic","isEditing","isGuestPost","mobile","resizable","isTopicOrMain","minimumTagLength","maximumTagLength","showHandleInput","allowGuestHandles","isAdmin","tagWhitelist","toggleNavbar","createData","parseAndTranslate","composerTemplate","each","unescape","document","append","isActive","handleResize","submitBtns","mobileSubmitBtn","textareaEl","idx","toggleClass","composerData","apply","path","returnPath","slice","replaceState","url","pushState","helpBtn","html","searchInput","quickSearchResults","setTimeout","enableTopicSearch","inputEl","resultEl","focus","putCursorAtEnd","thumbEl","onComposeRoute","trim","rtrim","checkTitle","isCategorySelected","inProgress","minimumTitleLength","maximumTitleLength","getTags","minimumTagsPerTopic","minimumPostLength","maximumPostLength","content","getSelectedCid","submitHookData","composerEl","redirect","taskbarIconEl","showEmailConfirmWarning","removeDraft","queued","go","slug","name","topic","onHide","css","paddingBottom","remove","close"],"mappings":"AAAA,aAIAA,OAAO,YACN,UACA,aACA,oBACA,mBACA,sBACA,kBACA,gBACA,wBACA,mBACA,kBACA,wBACA,cACE,SAASC,EAASC,EAAYC,EAAUC,EAASC,EAAYC,EAAQC,EAAMC,EAAcC,EAASC,EAAQC,EAAcC,GAC1H,IAAIC,GACHC,OAAQC,UACRC,SACAC,cAAeF,UACfV,WAAYU,WAGbG,EAAEC,QAAQC,IAAI,SAAUC,GAAgBC,GAAG,SAAUD,GACrDA,IAEAH,EAAEC,QAAQG,GAAG,8BAA+B,SAASC,EAAIC,GACxDC,aAAaC,WAAW,YAAcF,EAAKA,KAAKG,IAAM,aACtDF,aAAaC,WAAW,YAAcF,EAAKA,KAAKG,IAAM,uBAGvDT,EAAEC,QAAQG,GAAG,WAAY,WACxB,IAAIM,EAAMC,MAAMC,2BAChB,GAAIjB,EAASC,SAAWc,IAAQ,MAAQA,IAAO,MAAO,CACrD,IAAKf,EAASG,MAAMH,EAASC,QAAQiB,SAAU,CAC9ClB,EAASmB,QAAQnB,EAASC,QAC1B,GAAID,EAASoB,gBAAkBpB,EAASoB,eAAeC,OAAQ,CAC9DrB,EAASoB,eAAeE,MAAM,eACvBtB,EAASoB,eAEjB,OAGD/B,EAAWkC,UAAU,+BAAgC,SAASC,GAC7DxB,EAASoB,eAAiBK,QAAQC,QAAQF,EAAY,SAASE,GAC9D,GAAIA,EAAS,CACZ1B,EAASmB,QAAQnB,EAASC,YACpB,CACND,EAASG,MAAMH,EAASC,QAAQiB,SAAW,QAG7ClB,EAASG,MAAMH,EAASC,QAAQiB,SAAW,WAK9C,SAASS,IACR,IAAIZ,EAAMf,EAASI,cACnB,GAAIwB,QAAQjB,KAAKkB,SAASC,UAAY,MAAQf,IAAQ,MAAQA,IAAO,KAAM,CAC1EgB,QAAQC,QAIV,SAASxB,IACR,IAAIO,EAAMC,MAAMC,2BAChB,IAAIgB,EAAWlB,IAAQ,MAAQA,IAAQ,KAEvC,GAAInB,EAAQsC,OAAQ,CACnB,GAAItC,EAAQmB,MAAQA,GAAOkB,EAAU,CACpCrC,EAAQmB,IAAMA,EACdnB,EAAQsC,OAAO,OAEhBtC,EAAQmB,IAAMA,EAGf,GAAIf,EAASC,SAAWC,UAAW,CAClCL,EAAOsC,WAAW9B,EAAE,wBAA0BL,EAASC,OAAS,OAEhE,IAAKgC,GAAY3B,OAAO8B,SAASC,SAASC,WAAWC,OAAOC,cAAgB,YAAa,CAMxFT,QAAQC,YACF,GAAIC,IAAa3B,OAAO8B,SAASC,SAASC,WAAWC,OAAOC,cAAgB,YAAa,CAK/FC,KAGFzC,EAASI,cAAgBW,EAG1B,SAAS2B,EAAYC,GAEpB,IAAIC,EAAMC,EAEV,GAAIF,EAAKG,eAAe,OAAQ,CAC/BF,EAAO,WACD,GAAID,EAAKG,eAAe,OAAQ,CACtCF,EAAO,WACD,GAAID,EAAKG,eAAe,OAAQ,CACtCF,EAAO,MAGRC,EAAKF,EAAKC,GAGV,IAAI,IAAIG,KAAQ/C,EAASG,MAAO,CAC/B,GAAIH,EAASG,MAAM4C,GAAMD,eAAeF,IAASC,IAAO7C,EAASG,MAAM4C,GAAMH,GAAO,CACnF,OAAOG,GAKT,OAAO,MAGR,SAASC,EAAKL,GACb,IAAII,EAAO/B,MAAMiC,eAChBC,EAAeR,EAAYC,GAE5B,GAAIO,EAAc,CACjB9D,EAAQ+D,aAAaD,GACrB,OAAOlD,EAASoD,KAAKF,GAGtB,IAAIG,EAAa,+BACjB,GAAIV,EAAKW,SAAW,cAAe,CAClCD,EAAa,sCACP,GAAIV,EAAKW,SAAW,aAAc,CACxCD,EAAa,6BAGdhE,EAAWkC,UAAU8B,EAAY,SAASE,GACzCnE,EAAQ4D,KAAK,WAAYD,GACxBS,MAAOD,EAAiBE,QAAQ,KAAM,IAAMd,EAAKa,MAAQ,SAK3D,GAAIb,EAAKG,eAAe,OAAQ,CAC/BH,EAAKe,SAAW,WAAYC,IAAIC,KAAKC,IAAK,MAAOlB,EAAK7B,KAAKgD,KAAK,UAC1D,GAAInB,EAAKG,eAAe,OAAQ,CACtCH,EAAKe,SAAW,WAAYC,IAAIC,KAAKC,IAAK,MAAOlB,EAAKoB,KAAKD,KAAK,UAC1D,GAAInB,EAAKG,eAAe,OAAQ,CACtCH,EAAKe,SAAW,WAAYC,IAAIC,KAAKC,IAAK,MAAOlB,EAAKqB,KAAKF,KAAK,KAIjErE,EAAOwE,iBAAiB,YAAatB,EAAKe,QAAS,MACnDjE,EAAOwE,iBAAiB,OAAQtB,EAAKe,QAAS,MAE9C1D,EAASG,MAAM4C,GAAQJ,EACvB3C,EAASoD,KAAKL,GAGf,SAASmB,EAAcC,EAAWC,GACjC/D,EAAE,wBAA0B8D,EAAY,MAAME,KAAK,oBAAoBC,WAAW,YAClFX,IAAIY,OACH3B,KAAM,SACN4B,QAAS,IACThB,MAAO,GACPY,QAASA,EACTK,SAAU,eAIZzE,EAAS0E,UAAY,SAASX,GAE7B,IAAI,IAAIhB,KAAQ/C,EAASG,MAAO,CAC/B,GAAIH,EAASG,MAAM2C,eAAeC,IAAS/C,EAASG,MAAM4C,GAAMD,eAAe,QAAU6B,SAAS3E,EAASG,MAAM4C,GAAMgB,IAAK,MAAQY,SAASZ,EAAK,IAAK,CACtJ,OAAOhB,GAIT,OAAO,MAGR/C,EAAS4E,UAAY,SAASC,EAAWC,EAAStB,GACjDhE,EAAWoF,UAAUC,EAAWC,EAAStB,IAG1CxD,EAAS+E,SAAW,SAASpE,GAC5B,IAAIqE,GACH1B,OAAQ,cACRxC,IAAKH,EAAKG,IACV0C,MAAO7C,EAAK6C,OAAS,GACrByB,KAAMtE,EAAKsE,MAAQ,GACnBvF,KAAMiB,EAAKjB,SACXwB,SAAYP,EAAK6C,OAAS7C,EAAK6C,MAAMnC,QAAYV,EAAKsE,MAAQtE,EAAKsE,KAAK5D,OAAW,KAAO,MAC1F6D,OAAQ,MAGT7E,EAAEC,QAAQ6E,QAAQ,8BACjBxE,KAAMA,EACNqE,SAAUA,IAGXhC,EAAKgC,IAGNhF,EAASoF,SAAW,SAASrB,EAAKsB,EAAOC,EAAa9B,EAAO+B,EAAUC,EAAMzC,GAC5EA,EAAOA,GAAQ/C,EAASC,OAExB,IAAIwF,GAAgBjC,GAAS,IAAIC,QAAQ,2BAA4B,QAAQA,QAAQ,MAAO,SAASA,QAAQ,MAAO,SAASA,QAAQ,KAAM,SAASA,QAAQ,KAAM,SAElK,GAAI+B,EAAM,CACTA,EAAO,KAAOA,EAAK/B,QAAQ,MAAO,QAAU,OAE7C,IAAIiC,EAAO,IAAMD,EAAe,KAAOlD,OAAOC,cAAgB,UAAY8C,GAAeD,GAAS,IAClG,GAAItC,IAAS7C,UAAW,CACvB,GAAIsD,IAAU8B,GAAeD,GAAQ,CACpCrF,EAAS2F,SAAS5B,EAAKsB,EAAO7B,EAAO,oCAAsC+B,EAAW,KAAOG,EAAO,OAASF,OACvG,CACNxF,EAAS2F,SAAS5B,EAAKsB,EAAO7B,EAAO,iCAAmC+B,EAAW,OAASC,GAE7F,YACM,GAAIzC,IAAS/C,EAASC,OAAQ,CAEpCD,EAASoD,KAAKL,GAGf,IAAI6C,EAAgBvF,EAAE,wBAA0B0C,EAAO,MACvD,IAAI8C,EAASD,EAAcvB,KAAK,YAChC,IAAIyB,EAAWD,EAAOE,MACtB,GAAIvC,IAAU8B,GAAeD,GAAQ,CACpChG,EAAWkC,UAAU,oCAAsCgE,EAAW,KAAOG,EAAO,OAAQnD,OAAOyD,YAAaC,OAC1G,CACN5G,EAAWkC,UAAU,iCAAmCgE,EAAW,OAAQhD,OAAOyD,YAAaC,GAGhG,SAASA,EAAazE,GACrBxB,EAASG,MAAM4C,GAAMkC,MAAQa,EAASzE,OAASyE,EAAW,OAAS,IAAMtE,EAAagE,EACtFK,EAAOE,IAAI/F,EAASG,MAAM4C,GAAMkC,MAChCiB,EAAcN,GACdhG,EAAQuG,OAAOP,KAIjB5F,EAAS2F,SAAW,SAAS5B,EAAKsB,EAAO7B,EAAOgC,GAC/CnG,EAAWkC,UAAUiE,EAAMjD,OAAOyD,YAAa,SAASxE,GACvDwB,GACCM,OAAQ,cACRS,IAAKA,EACLsB,MAAOA,EACP7B,MAAOA,EACPyB,KAAMzD,EACNN,SAAYsC,GAASA,EAAMnC,QAAYG,GAAcA,EAAWH,OAAW,KAAO,MAClF6D,OAAQ,WAKXlF,EAASoG,SAAW,SAASpC,GAC5BqC,OAAOC,KAAK,wBAAyBtC,EAAK,SAASuC,EAAKC,GACvD,GAAID,EAAK,CACR,OAAO5C,IAAI8C,WAAWF,EAAInC,SAE3BoC,EAAWlD,OAAS,aACpBkD,EAAWxC,IAAMA,EACjBwC,EAAWtF,SAAW,MACtB8B,EAAKwD,MAIPxG,EAASoD,KAAO,SAASe,GACxB,IAAIyB,EAAgBvF,EAAE,wBAA0B8D,EAAY,MAC5D,GAAIyB,EAAcvE,OAAQ,CACzBqF,EAASvC,GACTtE,EAAOsC,WAAWyD,GAClBM,EAAcN,GACde,QACM,CACN,GAAI3G,EAASR,WAAY,CACxBoH,EAAkBzC,OACZ,CACNkC,OAAOC,KAAK,wCAAyC,SAASC,EAAKM,GAClE7G,EAASR,WAAaqH,EACtBD,EAAkBzC,QAMtBnE,EAAS8G,QAAU,SAASlB,EAAezB,EAAW4C,GAMrD,IAAK5C,IAAc4C,EAAU,CAC5B5C,EAAYnD,MAAMiC,eAClBjD,EAASG,MAAMgE,GAAa4C,EAAWnF,QAAQjB,KAC/CiF,EAAcoB,KAAK,YAAa7C,GAGjC,IAAI8C,EAAUrB,EAAcvB,KAAK,eACjC,IAAI6C,EAAWtB,EAAcvB,KAAK,gBAClC,IAAIwB,EAASD,EAAcvB,KAAK,YAChC,IAAI8C,EAAQ1H,EAAO2H,IAAIL,EAASrD,SAChC,IAAI2D,EAAYzB,EAAcvB,KAAK,oBAEnC1E,EAAa2H,KAAK1B,EAAe5F,EAASG,MAAMgE,IAEhD3E,EAAW+H,WAAW3B,GACtBpG,EAAWgI,qBACX5H,EAAQ6H,cAAc7B,GAEtBA,EAAcvB,KAAK,mBAAmBqD,YAAY,QAClD9B,EAAcvB,KAAK,iBAAiBqD,YAAY,QAEhD,GAAI/D,IAAIC,KAAK+D,WAAW,oBAAqB,CAC5C/B,EAAcvB,KAAK,oBAAoBqD,YAAY,QACnD9B,EAAcvB,KAAK,iBAAiBqD,YAAY,QAGjDnI,EAAQqI,WAAWzD,GAEnB,GAAI5B,OAAOsF,sBAAwBd,EAAS7B,OAAQ,CACnD3F,EAAQuI,eAAelC,EAAe5F,EAASG,MAAMgE,GAAW4D,OAAS,IAG1ErI,EAAK4H,KAAK1B,EAAe5F,EAASG,MAAMgE,IAExCrE,EAAawH,KAAK1B,EAAezB,GAEjCyB,EAAcnF,GAAG,SAAU,kBAAmB,WAC7CT,EAASG,MAAMgE,GAAWjD,SAAW,OAGtCmG,EAAU5G,GAAG,QAAS,SAASuH,GAC9BA,EAAEC,iBACFD,EAAEE,kBAEF7H,EAAE8H,MAAMnB,KAAK,WAAY,MACzBrE,EAAKwB,KAGNyB,EAAcwC,SAAS,SAAUC,GAChC,IAAIC,EAAWD,EAAME,MAAQF,EAAME,MAAQF,EAAMC,QACjD,IAAKA,IAAY,IAAMA,GAAW,KAAOD,EAAMG,QAAS,CACvDnB,EAAUL,KAAK,WAAY,MAC3BrE,EAAKwB,GACL,OAAO,MAER,OAAO,OAGRyB,EAAcvB,KAAK,qBAAqB5D,GAAG,QAAS,SAASuH,GAC5DA,EAAEC,iBAEF,IAAKjI,EAASG,MAAMgE,GAAWjD,SAAU,CACxClB,EAASmB,QAAQgD,GACjB,OAAOxC,IAGR,IAAI8G,EAAMpI,EAAE8H,MAAMO,KAAK,WAAY,MACnCrJ,EAAWkC,UAAU,+BAAgC,SAASC,GAC7DC,QAAQC,QAAQF,EAAY,SAASE,GACpC,GAAIA,EAAS,CACZ1B,EAASmB,QAAQgD,GACjBxC,IAED8G,EAAIC,KAAK,WAAY,aAKxB9C,EAAcvB,KAAK,sBAAsB5D,GAAG,QAAS,SAAUuH,GAC9DA,EAAEC,iBACFD,EAAEE,kBACFlI,EAAS2I,SAASxE,KAGnB0B,EAAOpF,GAAG,uBAAwB,WACjCb,EAAQuG,OAAOP,KAGhBC,EAAOpF,GAAG,SAAU,WACnBb,EAAQgJ,YAAYhD,KAGrBhG,EAAQuG,OAAOP,EAAe,WAC7BhG,EAAQgJ,YAAYhD,KAGrB,GAAIuB,GAASA,EAAM3D,MAAO,CACzByD,EAAQlB,IAAIoB,EAAM3D,OAEnB,GAAI2D,GAASA,EAAM0B,OAAQ,CAC1B3B,EAASnB,IAAIoB,EAAM0B,QAEpBhD,EAAOE,IAAIoB,EAAM3B,KAAO2B,EAAM3B,KAAOuB,EAAS9B,MAE9CxF,EAAO6H,KAAK1B,EAAemB,GAC3B+B,EAAWlD,GACXmD,EAAanD,GACbM,EAAcN,GAGd,UAAWoD,aAAe,cAAgBA,WAAWC,QAAS,CAC7D5I,EAAE,uBAAuB6I,SAAS,UAGnC7I,EAAEC,QAAQ6E,QAAQ,4BACjBS,cAAeA,EACfmB,SAAUA,KAIZ,SAASH,EAAkBzC,GAC1B,IAAI4C,EAAW/G,EAASG,MAAMgE,GAE9B,IAAI0D,EAAuBtF,OAAOsF,sBAAwBd,EAAS7B,OAClEiE,EAAUpC,EAAWA,EAASjE,eAAe,OAAS,MACtDoC,EAAS6B,IAAaA,EAAS7B,OAAS,MACxCkE,EAAYrC,IAAaA,EAAS/C,IAAM,MACxCqF,EAActC,EAAWpC,SAASoC,EAASlD,IAAK,MAAQ,EAAI,MAO7D,IAAIL,EAAQuD,EAASvD,MAAMC,QAAQ,KAAM,SAASA,QAAQ,KAAM,SAEhE,IAAI9C,GACH6C,MAAOA,EACP8F,OAAQtJ,EAASI,gBAAkB,MAAQJ,EAASI,gBAAkB,KACtEmJ,UAAW,KACX1B,qBAAsBA,EACtB2B,cAAeL,GAAWjE,EAC1BuE,iBAAkBlH,OAAOkH,iBACzBC,iBAAkBnH,OAAOmH,iBACzBP,QAASA,EACTC,UAAWA,EACXO,gBAAkBpH,OAAOqH,oBAAsBjG,IAAIC,KAAKC,MAAQ,GAAMuF,GAAaC,GAAe1F,IAAIC,KAAKiG,SAC3GhB,OAAQ9B,EAAWA,EAAS8B,QAAU,GAAK3I,UAC3CV,WAAYQ,EAASR,WACrBsK,aAAclI,QAAQjB,KAAKmJ,aAC3BnC,WAAYhE,IAAIC,KAAK+D,YAGtB,GAAIhH,EAAK2I,OAAQ,CAChB7G,IAEAkB,IAAIoG,aAAa,OAGlBhD,EAASuC,OAAStJ,EAASI,gBAAkB,MAAQJ,EAASI,gBAAkB,KAEhFC,EAAEC,QAAQ6E,QAAQ,0BACjB4B,SAAUA,EACViD,WAAYrJ,IAGbgD,IAAIsG,kBAAkB,WAAYtJ,EAAM,SAASuJ,GAChD,GAAI7J,EAAE,iCAAmC8D,EAAY,MAAM9C,OAAQ,CAClE,OAED6I,EAAmB7J,EAAE6J,GAErBA,EAAiB7F,KAAK,UAAU8F,KAAK,WACpC9J,EAAE8H,MAAM3C,KAAKnG,EAAW+K,SAAS/J,EAAE8H,MAAM3C,WAG1C0E,EAAiBlD,KAAK,YAAa7C,GAEnC9D,EAAEgK,SAASpF,MAAMqF,OAAOJ,GAExB,IAAItE,EAAgBvF,EAAE6J,EAAiB,IAEvCrK,EAAOsC,WAAWyD,GAClB5F,EAAS8G,QAAQlB,EAAezB,EAAW4C,GAS3CL,EAASvC,GAETyB,EAAcnF,GAAG,QAAS,WACzB,IAAKrB,EAAQmL,SAASpG,GAAY,CACjC/E,EAAQ+D,aAAagB,MAIvBtE,EAAO2K,aAAa5E,GAEpB,GAAI5F,EAASI,gBAAkB,MAAQJ,EAASI,gBAAkB,KAAM,CACvE,IAAIqK,EAAa7E,EAAcvB,KAAK,oBACnCqG,EAAkB9E,EAAcvB,KAAK,mCACrCsG,EAAa/E,EAAcvB,KAAK,UAChCuG,EAAMD,EAAW3D,KAAK,YAEvByD,EAAWnG,WAAW,YACtBoG,EAAgB1D,KAAK,WAAYrC,SAASiG,EAAK,IAAI,GAEnDvK,EAAE,4BAA4BI,GAAG,QAAS,WACzCJ,EAAE,sBAAsBwK,YAAY,UAItCxK,EAAEC,QAAQ6E,QAAQ,0BACjBhB,UAAWA,EACX2G,aAAc9K,EAASG,MAAMgE,GAC7B3E,WAAYQ,EAASR,aAGtBO,EAAWgL,MAAMnF,EAAcvB,KAAK,WACpC6B,EAAcN,GACde,MAKF,SAASlE,IACR,IAAIuI,EAAO,aAAe1K,OAAO8B,SAASC,SACzC4I,EAAa3K,OAAO8B,SAASC,SAAS6I,MAAM,GAG7C,GAAID,EAAW3I,WAAWC,OAAOC,cAAc0I,MAAM,IAAK,CACzDD,EAAaA,EAAWC,MAAM3I,OAAOC,cAAcnB,QAIpDf,OAAOyB,QAAQoJ,cACdC,IAAK,KACLH,WAAYA,GACVA,EAAY1I,OAAOC,cAAgB,IAAMyI,GAG5C3K,OAAOyB,QAAQsJ,WACdD,IAAKJ,GACHA,EAAMzI,OAAOC,cAAgB,IAAMwI,GAGvC,SAASlC,EAAWlD,GACnB,IAAI0F,EAAU1F,EAAcvB,KAAK,SACjCgC,OAAOC,KAAK,8BAA+B,SAASC,EAAKgF,GACxD,IAAKhF,GAAOgF,GAAQA,EAAKlK,OAAS,EAAG,CACpCiK,EAAQ5D,YAAY,UACpB4D,EAAQ7K,GAAG,QAAS,WACnBgB,QAAQ8C,MAAMgH,QAMlB,SAASxC,EAAanD,GACrB,IAAI7C,EAAO6C,EAAcoB,KAAK,aAC9B,IAAIoC,EAAYpJ,EAASG,MAAM4C,IAAS/C,EAASG,MAAM4C,GAAMO,SAAW,aACxE,IAAIvC,EAAMC,MAAMC,2BAChB,IAAIgB,EAAWlB,IAAQ,MAAQA,IAAQ,KACvC,GAAIqI,GAAanH,EAAU,CAC1B,OAGD,IAAIuJ,EAAc5F,EAAcvB,KAAK,eACrC,IAAIoH,EAAqB7F,EAAcvB,KAAK,yBAC5CmH,EAAY/K,GAAG,OAAQ,WACtBiL,WAAW,WACVD,EAAmBvC,SAAS,WAC1B,OAEJvF,IAAIgI,mBACHC,QAASJ,EACTK,SAAUJ,IAIZ,SAAS/E,EAASvC,GACjB,GAAGnE,EAASC,QAAUD,EAASC,SAAWkE,EAAW,CACpDnE,EAAS2I,SAAS3I,EAASC,QAG5BD,EAASC,OAASkE,EAGnB,SAAS+B,EAAcN,GACtB8F,WAAW,WACV,IAAIlI,EAAQoC,EAAcvB,KAAK,eAE/B,GAAIb,EAAMnC,OAAQ,CACjBmC,EAAMsI,YACA,CACNlG,EAAcvB,KAAK,YAAYyH,QAAQC,mBAEtC,IAGJ,SAASpJ,EAAKwB,GACb,IAAI4C,EAAW/G,EAASG,MAAMgE,GAC9B,IAAIyB,EAAgBvF,EAAE,wBAA0B8D,EAAY,MAC5D,IAAI+C,EAAWtB,EAAcvB,KAAK,WAClC,IAAI4C,EAAUrB,EAAcvB,KAAK,UACjC,IAAIwB,EAASD,EAAcvB,KAAK,YAChC,IAAI2H,EAAUpG,EAAcvB,KAAK,yBACjC,IAAI4H,EAAiBlF,EAASjE,eAAe,aAAeiE,EAASlF,SAASC,UAAY,KAE1FmF,EAAQlB,IAAIkB,EAAQlB,MAAMmG,QAC1BrG,EAAOE,IAAI/E,MAAMmL,MAAMtG,EAAOE,QAC9B,GAAIiG,EAAQ3K,OAAQ,CACnB2K,EAAQjG,IAAIiG,EAAQjG,MAAMmG,QAG3B,IAAI5I,EAASyD,EAASzD,OAEtB,IAAI8I,GAAcrF,EAASjE,eAAe,QAAU6B,SAASoC,EAAS/C,IAAK,MAAQ4B,EAAcvB,KAAK,eAAehD,OACrH,IAAIgL,GAAsBD,GAAeA,GAAczH,SAASoC,EAASjG,IAAK,IAE9E,GAAIvB,EAAQ+M,WAAWnI,IAAc5E,EAAQ+M,WAAWnI,GAAW9C,OAAQ,CAC1E,OAAO6C,EAAcC,EAAW,kCAC1B,GAAIiI,GAAcnF,EAAQlB,MAAM1E,OAASsD,SAASpC,OAAOgK,mBAAoB,IAAK,CACxF,OAAOrI,EAAcC,EAAW,4BAA8B5B,OAAOgK,mBAAqB,WACpF,GAAIH,GAAcnF,EAAQlB,MAAM1E,OAASsD,SAASpC,OAAOiK,mBAAoB,IAAK,CACxF,OAAOtI,EAAcC,EAAW,2BAA6B5B,OAAOiK,mBAAqB,WACnF,GAAIlJ,IAAW,gBAAkB+I,EAAoB,CAC3D,OAAOnI,EAAcC,EAAW,wCAC1B,GAAIiI,GAAc1M,EAAK+M,QAAQtI,IAAczE,EAAK+M,QAAQtI,GAAW9C,OAASsD,SAASpC,OAAOmK,oBAAqB,IAAK,CAC9H,OAAOxI,EAAcC,EAAW,4BAA8B5B,OAAOmK,oBAAsB,WACrF,GAAI7G,EAAOE,MAAM1E,OAASsD,SAASpC,OAAOoK,kBAAmB,IAAK,CACxE,OAAOzI,EAAcC,EAAW,8BAAgC5B,OAAOoK,kBAAoB,WACrF,GAAI9G,EAAOE,MAAM1E,OAASsD,SAASpC,OAAOqK,kBAAmB,IAAK,CACxE,OAAO1I,EAAcC,EAAW,6BAA+B5B,OAAOqK,kBAAoB,MAG3F,IAAI9B,KAEJ,GAAIxH,IAAW,cAAe,CAC7BwH,GACCjC,OAAQ3B,EAAWA,EAASnB,MAAQ7F,UACpCsD,MAAOyD,EAAQlB,MACf8G,QAAShH,EAAOE,MAChBgC,MAAOiE,EAAQjG,OAAS,GACxBjF,IAAKnB,EAAamN,iBAClBpN,KAAMA,EAAK+M,QAAQtI,SAEd,GAAIb,IAAW,cAAe,CACpCwH,GACC/G,IAAKgD,EAAShD,IACd8E,OAAQ3B,EAAWA,EAASnB,MAAQ7F,UACpC2M,QAAShH,EAAOE,MAChBV,MAAO0B,EAAS1B,YAEX,GAAI/B,IAAW,aAAc,CACnCwH,GACC9G,IAAK+C,EAAS/C,IACd6E,OAAQ3B,EAAWA,EAASnB,MAAQ7F,UACpC2M,QAAShH,EAAOE,MAChBvC,MAAOyD,EAAQlB,MACfgC,MAAOiE,EAAQjG,OAAS,GACxBrG,KAAMA,EAAK+M,QAAQtI,IAGrB,IAAI4I,GACHC,WAAYpH,EACZtC,OAAQA,EACRwH,aAAcA,EACd/D,SAAUA,EACVkG,SAAU,MAEX5M,EAAEC,QAAQ6E,QAAQ,yBAA0B4H,GAG5C,IAAIG,EAAgB7M,EAAE,iCAAmC8D,EAAY,QACrE,IAAIwG,EAAa/E,EAAcvB,KAAK,UACpC6I,EAAcxF,YAAY,WAAWwB,SAAS,6BAC9ClJ,EAAS2I,SAASxE,GAClBwG,EAAWjC,KAAK,WAAY,MAE5BrC,OAAOC,KAAKhD,EAAQwH,EAAc,SAAUvE,EAAK5F,GAChDiF,EAAcvB,KAAK,oBAAoBC,WAAW,YAClD,GAAIiC,EAAK,CAERvG,EAASoD,KAAKe,GACdwG,EAAWjC,KAAK,WAAY,OAC5B,GAAInC,EAAInC,UAAY,gCAAiC,CACpD,OAAOT,IAAIwJ,wBAAwB5G,GAGpC,OAAO5C,IAAI8C,WAAWF,EAAInC,SAG3BpE,EAASmB,QAAQgD,GACjB1E,EAAO2N,YAAYrG,EAASrD,SAE5B,GAAI/C,EAAK0M,OAAQ,CAChB5L,QAAQ8C,MAAM5D,EAAKyD,aACb,CACN,GAAId,IAAW,cAAe,CAC7B,GAAIyJ,EAAeE,SAAU,CAC5BrL,QAAQ0L,GAAG,SAAW3M,EAAK4M,KAAMrN,UAAY+L,GAAkBjM,EAASI,gBAAkB,MAAQJ,EAASI,gBAAkB,KAAQ,KAAO,aAEvI,GAAIkD,IAAW,cAAe,CACpC,GAAI2I,GAAkBjM,EAASI,gBAAkB,MAAQJ,EAASI,gBAAkB,KAAM,CACzFE,OAAOyB,QAAQC,YACT,GAAI+K,EAAeE,WACvBrL,QAAQjB,KAAKkB,SAAS2L,OAAS,SAChC5L,QAAQjB,KAAKkB,SAAS4L,OAAS9I,SAASoC,EAAShD,IAAK,MAAQY,SAAS/C,QAAQjB,KAAKoD,IAAK,KACzF,CACDnC,QAAQ0L,GAAG,QAAU3M,EAAKqD,UAErB,CACNrC,KAIFtB,EAAEC,QAAQ6E,QAAQ,mBAAqB7B,GAAUwH,aAAcA,EAAcnK,KAAMA,MAIrF,SAASgG,IACRtG,EAAE,QAAQ6I,SAAS,aAGpB,SAASwE,IACRrN,EAAE,QAAQsN,KAAMC,cAAe,IAC/BvN,EAAE,QAAQqH,YAAY,aACtB/D,IAAIoG,aAAa,MAGlB/J,EAASmB,QAAU,SAASgD,GAC3B,GAAInE,EAASG,MAAMgE,GAAY,CAC9B,IAAIyB,EAAgBvF,EAAE,wBAA0B8D,EAAY,MAC5DyB,EAAciI,SACdpO,EAAO2N,YAAYpN,EAASG,MAAMgE,GAAWT,gBAEtC1D,EAASG,MAAMgE,GACtBnE,EAASC,OAASC,UAClBd,EAAQ+B,QAAQ,WAAYgD,GAC5B9D,EAAE,wBAAwBiE,WAAW,YAErCjE,EAAEC,QAAQ6E,QAAQ,2BACjBhB,UAAWA,IAGbuJ,KAID1N,EAAS8N,MAAQ9N,EAASmB,QAE1BnB,EAAS2I,SAAW,SAASxE,GAC5B,IAAIyB,EAAgBvF,EAAE,wBAA0B8D,EAAY,MAC5DyB,EAAc+H,IAAI,aAAc,UAChC3N,EAASC,OAASC,UAClBd,EAAQuJ,SAAS,WAAYxE,GAC7B9D,EAAEC,QAAQ6E,QAAQ,4BACjBhB,UAAWA,IAGZuJ,KAGD,OAAO1N","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer.js","sourcesContent":["'use strict';\n\n/* globals define, socket, app, config, ajaxify, utils, bootbox, screenfull */\n\ndefine('composer', [\n\t'taskbar',\n\t'translator',\n\t'composer/controls',\n\t'composer/uploads',\n\t'composer/formatting',\n\t'composer/drafts',\n\t'composer/tags',\n\t'composer/categoryList',\n\t'composer/preview',\n\t'composer/resize',\n\t'composer/autocomplete',\n\t'scrollStop'\n], function(taskbar, translator, controls, uploads, formatting, drafts, tags, categoryList, preview, resize, autocomplete, scrollStop) {\n\tvar composer = {\n\t\tactive: undefined,\n\t\tposts: {},\n\t\tbsEnvironment: undefined,\n\t\tformatting: undefined,\n\t};\n\n\t$(window).off('resize', onWindowResize).on('resize', onWindowResize);\n\tonWindowResize();\n\n\t$(window).on('action:composer.topics.post', function(ev, data) {\n\t\tlocalStorage.removeItem('category:' + data.data.cid + ':bookmark');\n\t\tlocalStorage.removeItem('category:' + data.data.cid + ':bookmark:clicked');\n\t});\n\n\t$(window).on('popstate', function() {\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tif (composer.active && (env === 'xs' || env ==='sm')) {\n\t\t\tif (!composer.posts[composer.active].modified) {\n\t\t\t\tcomposer.discard(composer.active);\n\t\t\t\tif (composer.discardConfirm && composer.discardConfirm.length) {\n\t\t\t\t\tcomposer.discardConfirm.modal('hide');\n\t\t\t\t\tdelete composer.discardConfirm;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttranslator.translate('[[modules:composer.discard]]', function(translated) {\n\t\t\t\tcomposer.discardConfirm = bootbox.confirm(translated, function(confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tcomposer.discard(composer.active);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomposer.posts[composer.active].modified = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcomposer.posts[composer.active].modified = false;\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction removeComposerHistory() {\n\t\tvar env = composer.bsEnvironment;\n\t\tif (ajaxify.data.template.compose === true || env === 'xs' || env ==='sm') {\n\t\t\thistory.back();\n\t\t}\n\t}\n\n\tfunction onWindowResize() {\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tvar isMobile = env === 'xs' || env === 'sm';\n\n\t\tif (preview.toggle) {\n\t\t\tif (preview.env !== env && isMobile) {\n\t\t\t\tpreview.env = env;\n\t\t\t\tpreview.toggle(false);\n\t\t\t}\n\t\t\tpreview.env = env;\n\t\t}\n\n\t\tif (composer.active !== undefined) {\n\t\t\tresize.reposition($('.composer[data-uuid=\"' + composer.active + '\"]'));\n\n\t\t\tif (!isMobile && window.location.pathname.startsWith(config.relative_path + '/compose')) {\n\t\t\t\t/*\n\t\t\t\t *\tIf this conditional is met, we're no longer in mobile/tablet\n\t\t\t\t *\tresolution but we've somehow managed to have a mobile\n\t\t\t\t *\tcomposer load, so let's go back to the topic\n\t\t\t\t */\n\t\t\t\thistory.back();\n\t\t\t} else if (isMobile && !window.location.pathname.startsWith(config.relative_path + '/compose')) {\n\t\t\t\t/*\n\t\t\t\t *\tIn this case, we're in mobile/tablet resolution but the composer\n\t\t\t\t *\tthat loaded was a regular composer, so let's fix the address bar\n\t\t\t\t */\n\t\t\t\tmobileHistoryAppend();\n\t\t\t}\n\t\t}\n\t\tcomposer.bsEnvironment = env;\n\t}\n\n\tfunction alreadyOpen(post) {\n\t\t// If a composer for the same cid/tid/pid is already open, return the uuid, else return bool false\n\t\tvar\ttype, id;\n\n\t\tif (post.hasOwnProperty('cid')) {\n\t\t\ttype = 'cid';\n\t\t} else if (post.hasOwnProperty('tid')) {\n\t\t\ttype = 'tid';\n\t\t} else if (post.hasOwnProperty('pid')) {\n\t\t\ttype = 'pid';\n\t\t}\n\n\t\tid = post[type];\n\n\t\t// Find a match\n\t\tfor(var uuid in composer.posts) {\n\t\t\tif (composer.posts[uuid].hasOwnProperty(type) && id === composer.posts[uuid][type]) {\n\t\t\t\treturn uuid;\n\t\t\t}\n\t\t}\n\n\t\t// No matches...\n\t\treturn false;\n\t}\n\n\tfunction push(post) {\n\t\tvar uuid = utils.generateUUID(),\n\t\t\texistingUUID = alreadyOpen(post);\n\n\t\tif (existingUUID) {\n\t\t\ttaskbar.updateActive(existingUUID);\n\t\t\treturn composer.load(existingUUID);\n\t\t}\n\n\t\tvar actionText = '[[topic:composer.new_topic]]';\n\t\tif (post.action === 'posts.reply') {\n\t\t\tactionText = '[[topic:composer.replying_to]]';\n\t\t} else if (post.action === 'posts.edit') {\n\t\t\tactionText = '[[topic:composer.editing]]';\n\t\t}\n\n\t\ttranslator.translate(actionText, function(translatedAction) {\n\t\t\ttaskbar.push('composer', uuid, {\n\t\t\t\ttitle: translatedAction.replace('%1', '\"' + post.title + '\"')\n\t\t\t});\n\t\t});\n\n\t\t// Construct a save_id\n\t\tif (post.hasOwnProperty('cid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'cid', post.cid].join(':');\n\t\t} else if (post.hasOwnProperty('tid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'tid', post.tid].join(':');\n\t\t} else if (post.hasOwnProperty('pid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'pid', post.pid].join(':');\n\t\t}\n\n\t\t// Post is opened, save to list of opened drafts\n\t\tdrafts.updateVisibility('available', post.save_id, true);\n\t\tdrafts.updateVisibility('open', post.save_id, true);\n\n\t\tcomposer.posts[uuid] = post;\n\t\tcomposer.load(uuid);\n\t}\n\n\tfunction composerAlert(post_uuid, message) {\n\t\t$('.composer[data-uuid=\"' + post_uuid + '\"]').find('.composer-submit').removeAttr('disabled');\n\t\tapp.alert({\n\t\t\ttype: 'danger',\n\t\t\ttimeout: 3000,\n\t\t\ttitle: '',\n\t\t\tmessage: message,\n\t\t\talert_id: 'post_error'\n\t\t});\n\t}\n\n\tcomposer.findByTid = function(tid) {\n\t\t// Iterates through the initialised composers and returns the uuid of the matching composer\n\t\tfor(var uuid in composer.posts) {\n\t\t\tif (composer.posts.hasOwnProperty(uuid) && composer.posts[uuid].hasOwnProperty('tid') && parseInt(composer.posts[uuid].tid, 10) === parseInt(tid, 10)) {\n\t\t\t\treturn uuid;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tcomposer.addButton = function(iconClass, onClick, title) {\n\t\tformatting.addButton(iconClass, onClick, title);\n\t};\n\n\tcomposer.newTopic = function(data) {\n\t\tvar pushData = {\n\t\t\taction: 'topics.post',\n\t\t\tcid: data.cid,\n\t\t\ttitle: data.title || '',\n\t\t\tbody: data.body || '',\n\t\t\ttags: data.tags || [],\n\t\t\tmodified: ((data.title && data.title.length) || (data.body && data.body.length)) ? true : false,\n\t\t\tisMain: true\n\t\t};\n\n\t\t$(window).trigger('filter:composer.topic.push', {\n\t\t\tdata: data,\n\t\t\tpushData: pushData\n\t\t});\n\n\t\tpush(pushData);\n\t};\n\n\tcomposer.addQuote = function(tid, toPid, selectedPid, title, username, text, uuid) {\n\t\tuuid = uuid || composer.active;\n\n\t\tvar escapedTitle = (title || '').replace(/([\\\\`*_{}\\[\\]()#+\\-.!])/g, '\\\\$1').replace(/\\[/g, '&#91;').replace(/\\]/g, '&#93;').replace(/%/g, '&#37;').replace(/,/g, '&#44;');\n\n\t\tif (text) {\n\t\t\ttext = '> ' + text.replace(/\\n/g, '\\n> ') + '\\n\\n';\n\t\t}\n\t\tvar link = '[' + escapedTitle + '](' + config.relative_path + '/post/' + (selectedPid || toPid) + ')';\n\t\tif (uuid === undefined) {\n\t\t\tif (title && (selectedPid || toPid)) {\n\t\t\t\tcomposer.newReply(tid, toPid, title, '[[modules:composer.user_said_in, ' + username + ', ' + link + ']]\\n' + text);\n\t\t\t} else {\n\t\t\t\tcomposer.newReply(tid, toPid, title, '[[modules:composer.user_said, ' + username + ']]\\n' + text);\n\t\t\t}\n\t\t\treturn;\n\t\t} else if (uuid !== composer.active) {\n\t\t\t// If the composer is not currently active, activate it\n\t\t\tcomposer.load(uuid);\n\t\t}\n\n\t\tvar postContainer = $('.composer[data-uuid=\"' + uuid + '\"]');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar prevText = bodyEl.val();\n\t\tif (title && (selectedPid || toPid)) {\n\t\t\ttranslator.translate('[[modules:composer.user_said_in, ' + username + ', ' + link + ']]\\n', config.defaultLang, onTranslated);\n\t\t} else {\n\t\t\ttranslator.translate('[[modules:composer.user_said, ' + username + ']]\\n', config.defaultLang, onTranslated);\n\t\t}\n\n\t\tfunction onTranslated(translated) {\n\t\t\tcomposer.posts[uuid].body = (prevText.length ? prevText + '\\n\\n' : '') + translated + text;\n\t\t\tbodyEl.val(composer.posts[uuid].body);\n\t\t\tfocusElements(postContainer);\n\t\t\tpreview.render(postContainer);\n\t\t}\n\t};\n\n\tcomposer.newReply = function(tid, toPid, title, text) {\n\t\ttranslator.translate(text, config.defaultLang, function(translated) {\n\t\t\tpush({\n\t\t\t\taction: 'posts.reply',\n\t\t\t\ttid: tid,\n\t\t\t\ttoPid: toPid,\n\t\t\t\ttitle: title,\n\t\t\t\tbody: translated,\n\t\t\t\tmodified: ((title && title.length) || (translated && translated.length)) ? true : false,\n\t\t\t\tisMain: false\n\t\t\t});\n\t\t});\n\t};\n\n\tcomposer.editPost = function(pid) {\n\t\tsocket.emit('plugins.composer.push', pid, function(err, threadData) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tthreadData.action = 'posts.edit';\n\t\t\tthreadData.pid = pid;\n\t\t\tthreadData.modified = false;\n\t\t\tpush(threadData);\n\t\t});\n\t};\n\n\tcomposer.load = function(post_uuid) {\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tif (postContainer.length) {\n\t\t\tactivate(post_uuid);\n\t\t\tresize.reposition(postContainer);\n\t\t\tfocusElements(postContainer);\n\t\t\tonShow();\n\t\t} else {\n\t\t\tif (composer.formatting) {\n\t\t\t\tcreateNewComposer(post_uuid);\n\t\t\t} else {\n\t\t\t\tsocket.emit('plugins.composer.getFormattingOptions', function(err, options) {\n\t\t\t\t\tcomposer.formatting = options;\n\t\t\t\t\tcreateNewComposer(post_uuid);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tcomposer.enhance = function(postContainer, post_uuid, postData) {\n\t\t/*\n\t\t\tThis method enhances a composer container with client-side sugar (preview, etc)\n\t\t\tEverything in here also applies to the /compose route\n\t\t*/\n\n\t\tif (!post_uuid && !postData) {\n\t\t\tpost_uuid = utils.generateUUID();\n\t\t\tcomposer.posts[post_uuid] = postData = ajaxify.data;\n\t\t\tpostContainer.attr('data-uuid', post_uuid);\n\t\t}\n\n\t\tvar titleEl = postContainer.find('input.title');\n\t\tvar handleEl = postContainer.find('input.handle');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar draft = drafts.get(postData.save_id);\n\t\tvar submitBtn = postContainer.find('.composer-submit');\n\n\t\tcategoryList.init(postContainer, composer.posts[post_uuid]);\n\n\t\tformatting.addHandler(postContainer);\n\t\tformatting.addComposerButtons();\n\t\tpreview.handleToggler(postContainer);\n\n\t\tpostContainer.find('.img-upload-btn').removeClass('hide');\n\t\tpostContainer.find('#files.lt-ie9').removeClass('hide');\n\n\t\tif (app.user.privileges['upload:post:file']) {\n\t\t\tpostContainer.find('.file-upload-btn').removeClass('hide');\n\t\t\tpostContainer.find('#files.lt-ie9').removeClass('hide');\n\t\t}\n\n\t\tuploads.initialize(post_uuid);\n\n\t\tif (config.allowTopicsThumbnail && postData.isMain) {\n\t\t\tuploads.toggleThumbEls(postContainer, composer.posts[post_uuid].thumb || '');\n\t\t}\n\n\t\ttags.init(postContainer, composer.posts[post_uuid]);\n\n\t\tautocomplete.init(postContainer, post_uuid);\n\n\t\tpostContainer.on('change', 'input, textarea', function() {\n\t\t\tcomposer.posts[post_uuid].modified = true;\n\t\t});\n\n\t\tsubmitBtn.on('click', function(e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\t// Other click events bring composer back to active state which is undesired on submit\n\n\t\t\t$(this).attr('disabled', true);\n\t\t\tpost(post_uuid);\n\t\t});\n\n\t\tpostContainer.keypress(function (event) {\n\t\t\tvar keyCode = (event.which ? event.which : event.keyCode);\n\t\t\tif ((keyCode === 10 || keyCode == 13) && event.ctrlKey) {\n\t\t\t\tsubmitBtn.attr('disabled', true);\n\t\t\t\tpost(post_uuid);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tpostContainer.find('.composer-discard').on('click', function(e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (!composer.posts[post_uuid].modified) {\n\t\t\t\tcomposer.discard(post_uuid);\n\t\t\t\treturn removeComposerHistory();\n\t\t\t}\n\n\t\t\tvar btn = $(this).prop('disabled', true);\n\t\t\ttranslator.translate('[[modules:composer.discard]]', function(translated) {\n\t\t\t\tbootbox.confirm(translated, function(confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tcomposer.discard(post_uuid);\n\t\t\t\t\t\tremoveComposerHistory();\n\t\t\t\t\t}\n\t\t\t\t\tbtn.prop('disabled', false);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tpostContainer.find('.composer-minimize').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tcomposer.minimize(post_uuid);\n\t\t});\n\n\t\tbodyEl.on('input propertychange', function() {\n\t\t\tpreview.render(postContainer);\n\t\t});\n\n\t\tbodyEl.on('scroll', function() {\n\t\t\tpreview.matchScroll(postContainer);\n\t\t});\n\n\t\tpreview.render(postContainer, function() {\n\t\t\tpreview.matchScroll(postContainer);\n\t\t});\n\n\t\tif (draft && draft.title) {\n\t\t\ttitleEl.val(draft.title);\n\t\t}\n\t\tif (draft && draft.handle) {\n\t\t\thandleEl.val(draft.handle);\n\t\t}\n\t\tbodyEl.val(draft.text ? draft.text : postData.body);\n\n\t\tdrafts.init(postContainer, postData);\n\t\thandleHelp(postContainer);\n\t\thandleSearch(postContainer);\n\t\tfocusElements(postContainer);\n\n\t\t// Hide \"zen mode\" if fullscreen API is not enabled/available (ahem, iOS...)\n\t\tif (typeof screenfull !== 'undefined' && !screenfull.enabled) {\n\t\t\t$('[data-format=\"zen\"]').addClass('hidden');\n\t\t}\n\n\t\t$(window).trigger('action:composer.enhanced', {\n\t\t\tpostContainer: postContainer,\n\t\t\tpostData: postData,\n\t\t});\n\t};\n\n\tfunction createNewComposer(post_uuid) {\n\t\tvar postData = composer.posts[post_uuid];\n\n\t\tvar allowTopicsThumbnail = config.allowTopicsThumbnail && postData.isMain,\n\t\t\tisTopic = postData ? postData.hasOwnProperty('cid') : false,\n\t\t\tisMain = postData ? !!postData.isMain : false,\n\t\t\tisEditing = postData ? !!postData.pid : false,\n\t\t\tisGuestPost = postData ? parseInt(postData.uid, 10) === 0 : false;\n\n\t\t// see\n\t\t// https://github.com/NodeBB/NodeBB/issues/2994 and\n\t\t// https://github.com/NodeBB/NodeBB/issues/1951\n\t\t// remove when 1951 is resolved\n\n\t\tvar title = postData.title.replace(/%/g, '&#37;').replace(/,/g, '&#44;');\n\n\t\tvar data = {\n\t\t\ttitle: title,\n\t\t\tmobile: composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm',\n\t\t\tresizable: true,\n\t\t\tallowTopicsThumbnail: allowTopicsThumbnail,\n\t\t\tisTopicOrMain: isTopic || isMain,\n\t\t\tminimumTagLength: config.minimumTagLength,\n\t\t\tmaximumTagLength: config.maximumTagLength,\n\t\t\tisTopic: isTopic,\n\t\t\tisEditing: isEditing,\n\t\t\tshowHandleInput:  config.allowGuestHandles && (app.user.uid === 0 || (isEditing && isGuestPost && app.user.isAdmin)),\n\t\t\thandle: postData ? postData.handle || '' : undefined,\n\t\t\tformatting: composer.formatting,\n\t\t\ttagWhitelist: ajaxify.data.tagWhitelist,\n\t\t\tprivileges: app.user.privileges,\n\t\t};\n\n\t\tif (data.mobile) {\n\t\t\tmobileHistoryAppend();\n\n\t\t\tapp.toggleNavbar(false);\n\t\t}\n\n\t\tpostData.mobile = composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm';\n\n\t\t$(window).trigger('filter:composer.create', {\n\t\t\tpostData: postData,\n\t\t\tcreateData: data\n\t\t});\n\n\t\tapp.parseAndTranslate('composer', data, function(composerTemplate) {\n\t\t\tif ($('.composer.composer[data-uuid=\"' + post_uuid + '\"]').length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcomposerTemplate = $(composerTemplate);\n\n\t\t\tcomposerTemplate.find('.title').each(function () {\n\t\t\t\t$(this).text(translator.unescape($(this).text()));\n\t\t\t});\n\n\t\t\tcomposerTemplate.attr('data-uuid', post_uuid);\n\n\t\t\t$(document.body).append(composerTemplate);\n\n\t\t\tvar postContainer = $(composerTemplate[0]);\n\n\t\t\tresize.reposition(postContainer);\n\t\t\tcomposer.enhance(postContainer, post_uuid, postData);\n\t\t\t/*\n\t\t\t\tEverything after this line is applied to the resizable composer only\n\t\t\t\tWant something done to both resizable composer and the one in /compose?\n\t\t\t\tPut it in composer.enhance().\n\n\t\t\t\tEventually, stuff after this line should be moved into composer.enhance().\n\t\t\t*/\n\n\t\t\tactivate(post_uuid);\n\n\t\t\tpostContainer.on('click', function() {\n\t\t\t\tif (!taskbar.isActive(post_uuid)) {\n\t\t\t\t\ttaskbar.updateActive(post_uuid);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tresize.handleResize(postContainer);\n\n\t\t\tif (composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm') {\n\t\t\t\tvar submitBtns = postContainer.find('.composer-submit'),\n\t\t\t\t\tmobileSubmitBtn = postContainer.find('.mobile-navbar .composer-submit'),\n\t\t\t\t\ttextareaEl = postContainer.find('.write'),\n\t\t\t\t\tidx = textareaEl.attr('tabindex');\n\n\t\t\t\tsubmitBtns.removeAttr('tabindex');\n\t\t\t\tmobileSubmitBtn.attr('tabindex', parseInt(idx, 10)+1);\n\n\t\t\t\t$('.category-name-container').on('click', function() {\n\t\t\t\t\t$('.category-selector').toggleClass('open');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t$(window).trigger('action:composer.loaded', {\n\t\t\t\tpost_uuid: post_uuid,\n\t\t\t\tcomposerData: composer.posts[post_uuid],\n\t\t\t\tformatting: composer.formatting,\n\t\t\t});\n\n\t\t\tscrollStop.apply(postContainer.find('.write'));\n\t\t\tfocusElements(postContainer);\n\t\t\tonShow();\n\t\t});\n\n\t}\n\n\tfunction mobileHistoryAppend() {\n\t\tvar path = 'compose?p=' + window.location.pathname,\n\t\t\treturnPath = window.location.pathname.slice(1);\n\n\t\t// Remove relative path from returnPath\n\t\tif (returnPath.startsWith(config.relative_path.slice(1))) {\n\t\t\treturnPath = returnPath.slice(config.relative_path.length);\n\t\t}\n\n\t\t// Add in return path to be caught by ajaxify when post is completed, or if back is pressed\n\t\twindow.history.replaceState({\n\t\t\turl: null,\n\t\t\treturnPath: returnPath\n\t\t}, returnPath, config.relative_path + '/' + returnPath);\n\n\t\t// Update address bar in case f5 is pressed\n\t\twindow.history.pushState({\n\t\t\turl: path\n\t\t}, path, config.relative_path + '/' + path);\n\t}\n\n\tfunction handleHelp(postContainer) {\n\t\tvar helpBtn = postContainer.find('.help');\n\t\tsocket.emit('plugins.composer.renderHelp', function(err, html) {\n\t\t\tif (!err && html && html.length > 0) {\n\t\t\t\thelpBtn.removeClass('hidden');\n\t\t\t\thelpBtn.on('click', function() {\n\t\t\t\t\tbootbox.alert(html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handleSearch(postContainer) {\n\t\tvar uuid = postContainer.attr('data-uuid');\n\t\tvar isEditing = composer.posts[uuid] && composer.posts[uuid].action === 'posts.edit';\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tvar isMobile = env === 'xs' || env === 'sm';\n\t\tif (isEditing || isMobile) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar searchInput = postContainer.find('input.title');\n\t\tvar quickSearchResults = postContainer.find('.quick-search-results');\n\t\tsearchInput.on('blur', function () {\n\t\t\tsetTimeout(function () {\n\t\t\t\tquickSearchResults.addClass('hidden');\n\t\t\t}, 200);\n\t\t});\n\t\tapp.enableTopicSearch({\n\t\t\tinputEl: searchInput,\n\t\t\tresultEl: quickSearchResults,\n\t\t});\n\t}\n\n\tfunction activate(post_uuid) {\n\t\tif(composer.active && composer.active !== post_uuid) {\n\t\t\tcomposer.minimize(composer.active);\n\t\t}\n\n\t\tcomposer.active = post_uuid;\n\t}\n\n\tfunction focusElements(postContainer) {\n\t\tsetTimeout(function() {\n\t\t\tvar title = postContainer.find('input.title');\n\n\t\t\tif (title.length) {\n\t\t\t\ttitle.focus();\n\t\t\t} else {\n\t\t\t\tpostContainer.find('textarea').focus().putCursorAtEnd();\n\t\t\t}\n\t\t}, 20);\n\t}\n\n\tfunction post(post_uuid) {\n\t\tvar postData = composer.posts[post_uuid];\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tvar handleEl = postContainer.find('.handle');\n\t\tvar titleEl = postContainer.find('.title');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar thumbEl = postContainer.find('input#topic-thumb-url');\n\t\tvar onComposeRoute = postData.hasOwnProperty('template') && postData.template.compose === true;\n\n\t\ttitleEl.val(titleEl.val().trim());\n\t\tbodyEl.val(utils.rtrim(bodyEl.val()));\n\t\tif (thumbEl.length) {\n\t\t\tthumbEl.val(thumbEl.val().trim());\n\t\t}\n\n\t\tvar action = postData.action;\n\n\t\tvar checkTitle = (postData.hasOwnProperty('cid') || parseInt(postData.pid, 10)) && postContainer.find('input.title').length;\n\t\tvar isCategorySelected = !checkTitle || (checkTitle && parseInt(postData.cid, 10));\n\n\t\tif (uploads.inProgress[post_uuid] && uploads.inProgress[post_uuid].length) {\n\t\t\treturn composerAlert(post_uuid, '[[error:still-uploading]]');\n\t\t} else if (checkTitle && titleEl.val().length < parseInt(config.minimumTitleLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:title-too-short, ' + config.minimumTitleLength + ']]');\n\t\t} else if (checkTitle && titleEl.val().length > parseInt(config.maximumTitleLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:title-too-long, ' + config.maximumTitleLength + ']]');\n\t\t} else if (action === 'topics.post' && !isCategorySelected) {\n\t\t\treturn composerAlert(post_uuid, '[[error:category-not-selected]]');\n\t\t} else if (checkTitle && tags.getTags(post_uuid) && tags.getTags(post_uuid).length < parseInt(config.minimumTagsPerTopic, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:not-enough-tags, ' + config.minimumTagsPerTopic + ']]');\n\t\t} else if (bodyEl.val().length < parseInt(config.minimumPostLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:content-too-short, ' + config.minimumPostLength + ']]');\n\t\t} else if (bodyEl.val().length > parseInt(config.maximumPostLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:content-too-long, ' + config.maximumPostLength + ']]');\n\t\t}\n\n\t\tvar composerData = {};\n\n\t\tif (action === 'topics.post') {\n\t\t\tcomposerData = {\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\ttitle: titleEl.val(),\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\tthumb: thumbEl.val() || '',\n\t\t\t\tcid: categoryList.getSelectedCid(),\n\t\t\t\ttags: tags.getTags(post_uuid)\n\t\t\t};\n\t\t} else if (action === 'posts.reply') {\n\t\t\tcomposerData = {\n\t\t\t\ttid: postData.tid,\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\ttoPid: postData.toPid\n\t\t\t};\n\t\t} else if (action === 'posts.edit') {\n\t\t\tcomposerData = {\n\t\t\t\tpid: postData.pid,\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\ttitle: titleEl.val(),\n\t\t\t\tthumb: thumbEl.val() || '',\n\t\t\t\ttags: tags.getTags(post_uuid)\n\t\t\t};\n\t\t}\n\t\tvar submitHookData = {\n\t\t\tcomposerEl: postContainer,\n\t\t\taction: action,\n\t\t\tcomposerData: composerData,\n\t\t\tpostData: postData,\n\t\t\tredirect: true,\n\t\t}\n\t\t$(window).trigger('action:composer.submit', submitHookData);\n\n\t\t// Minimize composer (and set textarea as readonly) while submitting\n\t\tvar taskbarIconEl = $('#taskbar .composer[data-uuid=\"' + post_uuid + '\"] i');\n\t\tvar textareaEl = postContainer.find('.write');\n\t\ttaskbarIconEl.removeClass('fa-plus').addClass('fa-circle-o-notch fa-spin');\n\t\tcomposer.minimize(post_uuid);\n\t\ttextareaEl.prop('readonly', true);\n\n\t\tsocket.emit(action, composerData, function (err, data) {\n\t\t\tpostContainer.find('.composer-submit').removeAttr('disabled');\n\t\t\tif (err) {\n\t\t\t\t// Restore composer on error\n\t\t\t\tcomposer.load(post_uuid);\n\t\t\t\ttextareaEl.prop('readonly', false);\n\t\t\t\tif (err.message === '[[error:email-not-confirmed]]') {\n\t\t\t\t\treturn app.showEmailConfirmWarning(err);\n\t\t\t\t}\n\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tcomposer.discard(post_uuid);\n\t\t\tdrafts.removeDraft(postData.save_id);\n\n\t\t\tif (data.queued) {\n\t\t\t\tbootbox.alert(data.message);\n\t\t\t} else {\n\t\t\t\tif (action === 'topics.post') {\n\t\t\t\t\tif (submitHookData.redirect) {\n\t\t\t\t\t\tajaxify.go('topic/' + data.slug, undefined, (onComposeRoute || composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm') ? true : false);\n\t\t\t\t\t}\n\t\t\t\t} else if (action === 'posts.reply') {\n\t\t\t\t\tif (onComposeRoute || composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm') {\n\t\t\t\t\t\twindow.history.back();\n\t\t\t\t\t} else if (submitHookData.redirect &&\n\t\t\t\t\t\t((ajaxify.data.template.name !== 'topic') ||\n\t\t\t\t\t\t(ajaxify.data.template.topic && parseInt(postData.tid, 10) !== parseInt(ajaxify.data.tid, 10)))\n\t\t\t\t\t) {\n\t\t\t\t\t\tajaxify.go('post/' + data.pid);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tremoveComposerHistory();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$(window).trigger('action:composer.' + action, { composerData: composerData, data: data });\n\t\t});\n\t}\n\n\tfunction onShow() {\n\t\t$('html').addClass('composing');\n\t}\n\n\tfunction onHide() {\n\t\t$('body').css({ paddingBottom: 0 });\n\t\t$('html').removeClass('composing');\n\t\tapp.toggleNavbar(true);\n\t}\n\n\tcomposer.discard = function(post_uuid) {\n\t\tif (composer.posts[post_uuid]) {\n\t\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\t\tpostContainer.remove();\n\t\t\tdrafts.removeDraft(composer.posts[post_uuid].save_id);\n\n\t\t\tdelete composer.posts[post_uuid];\n\t\t\tcomposer.active = undefined;\n\t\t\ttaskbar.discard('composer', post_uuid);\n\t\t\t$('[data-action=\"post\"]').removeAttr('disabled');\n\n\t\t\t$(window).trigger('action:composer.discard', {\n\t\t\t\tpost_uuid: post_uuid,\n\t\t\t});\n\t\t}\n\t\tonHide();\n\t};\n\n\t// Alias to .discard();\n\tcomposer.close = composer.discard;\n\n\tcomposer.minimize = function(post_uuid) {\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tpostContainer.css('visibility', 'hidden');\n\t\tcomposer.active = undefined;\n\t\ttaskbar.minimize('composer', post_uuid);\n\t\t$(window).trigger('action:composer.minimize', {\n\t\t\tpost_uuid: post_uuid,\n\t\t});\n\n\t\tonHide();\n\t};\n\n\treturn composer;\n});\n"]}